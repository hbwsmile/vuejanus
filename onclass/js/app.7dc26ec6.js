(function(e){function n(n){for(var r,i,c=n[0],a=n[1],l=n[2],d=0,f=[];d<c.length;d++)i=c[d],Object.prototype.hasOwnProperty.call(t,i)&&t[i]&&f.push(t[i][0]),t[i]=0;for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r]);u&&u(n);while(f.length)f.shift()();return s.push.apply(s,l||[]),o()}function o(){for(var e,n=0;n<s.length;n++){for(var o=s[n],r=!0,c=1;c<o.length;c++){var a=o[c];0!==t[a]&&(r=!1)}r&&(s.splice(n--,1),e=i(i.s=o[0]))}return e}var r={},t={app:0},s=[];function i(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=r,i.d=function(e,n,o){i.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,n){if(1&n&&(e=i(e)),8&n)return e;if(4&n&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)i.d(o,r,function(n){return e[n]}.bind(null,r));return o},i.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(n,"a",n),n},i.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},i.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],a=c.push.bind(c);c.push=n,c=c.slice();for(var l=0;l<c.length;l++)n(c[l]);var u=a;s.push([0,"chunk-vendors"]),o()})({0:function(e,n,o){e.exports=o("56d7")},"0d09":function(e,n,o){var r=o("860c"),t=r.randomString,s=o("860c");function i(e,n,o){var r=t(),i={request:"create",description:"uWss meeting",room:e,bitrate:4096e3,bitrate_cap:!0,publishers:5,notify_joining:!0},c={janus:"message",body:i,transaction:r,session_id:n,handle_id:o};return s[r]={success:function(e){return console.log("create room success:"+e),s["syncSignal"]["createroom"]},id:function(){},error:function(e){console.log("create room error:"+e)}},JSON.stringify(c)}function c(e,n,o){var r=t(),i={request:"join",room:e,ptype:"publisher",display:"new_web",terminal:"web"},c={janus:"message",body:i,transaction:r,session_id:n,handle_id:o},a=null,l=null,u=0;return s[r]={success:function(e){return console.log("join room success:"+e),s["syncSignal"]["joinroom"]},id:function(){return u},error:function(e){console.log("join room error:"+e)},event:function(e){console.log("join room async:"+e);var n=JSON.parse(e),o=n["plugindata"];if(null!=o){var r=o["data"];if(null!=r){u=r["id"];var t=r["list"];a=r["publishers"];var i={};for(var c in t)i[t[c]["id"]]=t[c];for(var d in a){var f=a[d];"video"==f["mediatype"]?(console.log(i),console.log(a),i[f["id"]]["mutevideo"]=!1):"screen"==f["mediatype"]&&(i[f["id"]]["screenshare"]=!0)}return l=i,console.log(l),s["eventSignal"]["joinroom"]}}},publishers:function(){return a},membserlists:function(){return l}},JSON.stringify(c)}function a(e,n,o){var r=t(),i={request:"leave",room:e},c={janus:"message",body:i,transaction:r,session_id:n,handle_id:o};return s[r]={success:function(e){console.log("leave room success:"+e)},error:function(e){console.log("leave room error:"+e)},event:function(e){console.log("leave room async:"+e)}},JSON.stringify(c)}e.exports={createRoom:i,joinRoom:c,leaveRoom:a}},"235d":function(e,n,o){"use strict";var r=o("9c79"),t=o.n(r);t.a},3359:function(e,n,o){o("96cf");var r=o("c973"),t=o("860c"),s=t.randomString,i=o("860c"),c=null,a=null;function l(e,n,o,r,t){return u.apply(this,arguments)}function u(){return u=r(regeneratorRuntime.mark((function e(n,o,r,t,l){var u,d,f,m,g,v;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(u={DtlsSrtpKeyAgreement:!0},d={urls:"stun:stun.l.google.com:19302"},f={urls:"turn:turn.bistri.com:80",credential:"homeo",username:"homeo"},m={iceServers:[d,f]},g={optional:[u]},c=new RTCPeerConnection(m,g),"video"!=r){e.next=13;break}return e.next=9,navigator.mediaDevices.getUserMedia({video:!0,audio:!1});case 9:a=e.sent,t.srcObject=a,e.next=22;break;case 13:if("audio"!=r){e.next=19;break}return e.next=16,navigator.mediaDevices.getUserMedia({video:!1,audio:!0});case 16:a=e.sent,e.next=22;break;case 19:return e.next=21,navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1});case 21:a=e.sent;case 22:v=null,v="audio"==r?a.getAudioTracks():a.getVideoTracks(),console.log(v.length),v.length>0&&(c.addTrack(v[0]),console.log(a),c.createOffer().then((function(e){c.setLocalDescription(e)})).then((function(){var e=s(),t="audio"==r,a="video"==r||"screen"==r,u="screen"==r,d={request:"configure",audio:t,video:a,screen:u},f={janus:"message",body:d,transaction:e,session_id:n,handle_id:o,jsep:c.localDescription};i[e]={success:function(e){console.log("publish success"+e)},event:function(e){console.log("senderoffer success"+e);var n=JSON.parse(e),r=n["jsep"];console.log(r),c.setRemoteDescription(new RTCSessionDescription(r)),i[o]=c},error:function(e){console.log("subScribeMedia error"+e)}},l(JSON.stringify(f))})));case 26:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)}function d(e,n,o,r,t){l(e,n,o,r,t)}function f(e,n,o){console.log("delPublishser:"+n);var r=i[n];if(null!=r){var t=r.getSenders();t.length>0&&(console.log("remove track"+t[0].track.kind),console.log(t[0].track.kind),t[0].track.stop()),r.close()}var c=s(),a={request:"unpublish"},l={janus:"message",body:a,transaction:c,session_id:e,handle_id:n};o(JSON.stringify(l))}e.exports={createPublisher:d,delPublishser:f}},3470:function(e,n,o){e.exports=o.p+"img/screen-off.34c921f1.svg"},4242:function(e,n,o){e.exports=o.p+"img/audio.7b2cc773.svg"},4925:function(e,n,o){var r=o("860c"),t=r.randomString,s=o("860c"),i=0;function c(){var e=t(),n={janus:"create",transaction:e};return s[e]={success:function(e){console.log("create session success:");var n=JSON.parse(e),o=n["data"];if(null!=o)return i=o["id"],s["syncSignal"]["createsession"]},id:function(){return i},error:function(e){console.log("create handle error:"+e)}},JSON.stringify(n)}function a(){var e=t(),n={janus:"keepalive",transaction:e,session_id:i};return JSON.stringify(n)}e.exports={createSession:c,createKeepAlive:a}},"56d7":function(e,n,o){"use strict";o.r(n);o("e260"),o("e6cf"),o("cca6"),o("a79d");var r=o("2b0e"),t=function(){var e=this,n=e.$createElement,o=e._self._c||n;return o("div",{attrs:{id:"app"}},[o("div",{staticClass:"mainscreen"},[o("div",{staticClass:"screen",attrs:{id:"screen"}},[o("MainScreen")],1)])])},s=[],i=function(){var e=this,n=e.$createElement,r=e._self._c||n;return r("div",{attrs:{id:"mains"}},[r("video",{attrs:{id:"audioplay",height:"0",width:"0",autoplay:"",playsinline:""}}),r("div",{attrs:{id:"videos"}},e._l(e.videoitems,(function(e){return r("div",{key:e,staticClass:"cusvideo"},[r("video",{staticClass:"smallvideo",attrs:{id:"videoplay"+e,autoplay:""}}),r("div",{staticClass:"subname"},[r("p",{staticStyle:{margin:"0",padding:"0"},attrs:{id:"classname"+e}})]),r("div",{staticClass:"subvideo"},[r("img",{attrs:{src:o("3470"),id:"imgscreen"+e}}),r("img",{attrs:{src:o("ffb5"),id:"imgaudio"+e}}),r("img",{attrs:{src:o("ade9"),id:"imgcammera"+e}})])])})),0),e._m(0),r("div",{attrs:{id:"toolbar"}},[r("div"),r("div",{attrs:{id:"milddle-tool"}},[r("img",{attrs:{type:"button",src:e.audiobk},on:{click:e.changeaudio}}),r("img",{attrs:{type:"button",src:e.cammerabk},on:{click:e.changevideo}}),r("img",{attrs:{type:"button",src:e.screenbk},on:{click:e.changescreen}}),r("img",{attrs:{type:"button",src:o("c205")},on:{click:e.leavemeet}})]),r("div")])])},c=[function(){var e=this,n=e.$createElement,o=e._self._c||n;return o("div",{attrs:{id:"selfscreen"}},[o("video",{attrs:{id:"videoplay4",autoplay:"",playsinline:"",width:"100%",height:"100%"}})])}],a=o("efae"),l=o.n(a),u={data:function(){return{showmem:o("c75b"),audiobk:o("ffb5"),cammerabk:o("ade9"),screenbk:o("3470"),videoitems:[1,2,3],video4:null}},components:{},methods:{showmember:function(){console.log("显示列表1"),console.log(this.$store.state.isshowmember),this.$store.state.isshowmember?(this.showmem=o("c917"),this.$store.state.isshowmember=!1):(this.showmem=o("c75b"),this.$store.state.isshowmember=!0)},changevideo:function(){var e=this;l.a.openvideo((function(n,r){var t="imgcammera"+n;1==r?(e.cammerabk=o("e4ff"),document.getElementById(t).src=o("e4ff")):(e.cammerabk=o("ade9"),document.getElementById(t).src=o("ade9"))}))},changeaudio:function(){var e=this;l.a.openaudio((function(n,r){var t="imgaudio"+n;console.log("audio name:"+t),1==r?(e.audiobk=o("4242"),document.getElementById(t).src=o("4242")):(e.audiobk=o("ffb5"),document.getElementById(t).src=o("ffb5"))}))},changescreen:function(){var e=this;l.a.openscreen((function(n,r){var t="imgscreen"+n;console.log("imgscreen name:"+t),1==r?(e.screenbk=o("dce9"),document.getElementById(t).src=o("dce9")):(e.screenbk=o("3470"),document.getElementById(t).src=o("3470"))}))},leavemeet:function(){l.a.leavemeet()}},created:function(){console.log("created")},mounted:function(){if(console.log(document.querySelector("#audioplay")),void 0!=document.querySelector("#audioplay")){console.log("init");var e=[];e[0]=document.querySelector("#videoplay1"),e[1]=document.querySelector("#videoplay2"),e[2]=document.querySelector("#videoplay3"),e[3]=document.querySelector("#videoplay4"),l.a.init(document.querySelector("#audioplay"),e,(function(e,n,r,t){if("joined"==e){console.log("memberlist");var s=1;for(var i in r){var c="classname"+s;if(console.log("classname:"+c),document.getElementById(c).innerHTML=r[i]["display"],0==r[i]["muteaudio"]){var a="imgaudio"+s;document.getElementById(a).src=o("4242")}if(0==r[i]["mutevideo"]){var l="imgcammera"+s;document.getElementById(l).src=o("e4ff")}if(r[i]["screenshare"]){var u="imgscreen"+s;document.getElementById(u).src=o("dce9")}s++}}else if("joining"==e){var d="classname"+t;document.getElementById(d).innerHTML=r}else if("leaving"==e){console.log("member leaving:"+t);var f="classname"+t;document.getElementById(f).innerHTML=""}else if("publisher"==e){if("video"==n){var m="imgcammera"+t;document.getElementById(m).src=o("e4ff")}else if("screen"==n){var g="imgscreen"+t;document.getElementById(g).src=o("dce9")}}else if("unpublish"==e)if("video"==n){var v="imgcammera"+t;document.getElementById(v).src=o("ade9")}else if("screen"==n){var p="imgscreen"+t;document.getElementById(p).src=o("3470")}}))}}},d=u,f=(o("cd7b"),o("2877")),m=Object(f["a"])(d,i,c,!1,null,"fb9a7e3e",null),g=m.exports,v={name:"App",components:{MainScreen:g},beforeCreate:function(){},data:function(){return{isshowmem:!0}},methods:{transitionStart:function(){console.log("transitionStart"),document.getElementById("screen").style.width="80%"},transitionComplete:function(){console.log("transitionComplete"),document.getElementById("screen").style.width="100%"}}},p=v,b=(o("235d"),Object(f["a"])(p,t,s,!1,null,"0e0e65f5",null)),h=b.exports,y=o("8c4f");r["a"].use(y["a"]);var S=[],j=new y["a"]({mode:"history",base:"",routes:S}),w=j,O=o("2f62");r["a"].use(O["a"]);var k=new O["a"].Store({state:{isshowmember:!0},mutations:{},actions:{},modules:{}});r["a"].config.productionTip=!1,new r["a"]({router:w,store:k,render:function(e){return e(h)}}).$mount("#app")},"860c":function(e,n){var o={},r={none:0,createsession:1,createhandle:2,createroom:3,joinroom:4,subhandle:5},t={none:0,joinroom:1,createsuboffer:2};function s(){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,o="",r=0;r<n;r++)o+=e.charAt(Math.floor(Math.random()*n));return o}e.exports={allEvent:o,syncSignal:r,eventSignal:t,randomString:s}},"9c79":function(e,n,o){},aa23:function(e,n,o){var r=o("860c"),t=r.randomString,s=o("860c");function i(e){var n=t(),o=0,r={janus:"attach",plugin:"janus.plugin.videoroom",transaction:n,session_id:e};return s[n]={success:function(e){console.log(e);var n=JSON.parse(e),r=n["data"];if(null!=r)return o=r["id"],console.log("handle id:"+o),s["syncSignal"]["createhandle"]},id:function(){return o},error:function(e){console.log("create handle error:"+e)}},JSON.stringify(r)}e.exports={createHandler:i}},aab6:function(e,n,o){},ade9:function(e,n,o){e.exports=o.p+"img/cammera-off.6ac306fd.svg"},c205:function(e,n,o){e.exports=o.p+"img/leave.9412c8a3.svg"},c673:function(e,n,o){var r=o("860c"),t=r.randomString,s=o("860c");function i(e,n,o,r){var i=t(),c="",a={},l=0,u=n,d={janus:"attach",plugin:"janus.plugin.videoroom",transaction:i,session_id:r};return s[i]={success:function(t){console.log("create subcriberhandler success:"+t);var a=JSON.parse(t),u=a["data"];if(null!=u){l=u["id"],console.log("subcriber handle id:"+l);var d={request:"join",ptype:"subscriber",room:e,mediatype:o,feed:n},f={janus:"message",body:d,transaction:i,session_id:r,handle_id:l};return c=JSON.stringify(f),s["syncSignal"]["subhandle"]}},id:function(){return l},userid:function(){return u},event:function(e){console.log("handle subscriber event:"+e);var n=JSON.parse(e),o=n["jsep"];if(null!=o)return a=o,s["eventSignal"]["createsuboffer"]},error:function(e){console.log("create subscriber error:"+e)},submedia:function(){return c},getoffer:function(){return a},getmedia:function(){return o}},JSON.stringify(d)}function c(e,n,o,r,i,c){var a,l=t(),u={request:"start",room:n},d=new RTCPeerConnection,f=null;d.onaddstream=function(e){console.log("play success"),f=e.stream,i.srcObject=f},s[l]={success:function(e){console.log("sub success"+e)},event:function(e){console.log("subScribeMedia success"+e),console.log("subScribeMedia success"+i.srcObject)},error:function(e){console.log("subScribeMedia error"+e)}},d.setRemoteDescription(new RTCSessionDescription(e)),d.createAnswer().then((function(e){a=e,console.log("create answer success:"+a.sdp);var n={type:"answer",sdp:a.sdp},t={janus:"message",body:u,transaction:l,session_id:o,handle_id:r,jsep:n};c(JSON.stringify(t))})).then((function(){i.srcObject=f,d.setLocalDescription(a)}))}e.exports={createSubscriber:i,subScribeMedia:c}},c75b:function(e,n,o){e.exports=o.p+"img/left.34b4954b.svg"},c917:function(e,n,o){e.exports=o.p+"img/right.3a1bc053.svg"},cd7b:function(e,n,o){"use strict";var r=o("aab6"),t=o.n(r);t.a},dce9:function(e,n,o){e.exports=o.p+"img/screen.edc9564e.svg"},e4ff:function(e,n,o){e.exports=o.p+"img/cammera.2a2f3c53.svg"},efae:function(e,n,o){o("4160"),o("159b");var r=o("4925"),t=o("860c"),s=o("aa23"),i=s.createHandler,c=o("0d09"),a=c.createRoom,l=c.joinRoom,u=c.leaveRoom,d=o("c673"),f=d.createSubscriber,m=d.subScribeMedia,g=o("3359"),v=g.createPublisher,p=g.delPublishser;function b(){console.log("ClassHandler()")}var h=null,y=null,S=0,j=0,w=0,O=0,k=0,x=0,_=12354,E=[],J=[];function M(e,n){e.forEach((function(e){if(console.log("receive publisher:"+e["id"]+" "+e["mediatype"]),"audio"!=e["mediatype"]){var o=f(_,e["id"],e["mediatype"],S);if("audio"!=e["mediatype"]){var r=N(e["id"]);r>=0&&null!=n&&n("publisher",e["mediatype"],null,r+1)}h.send(o)}}))}function B(e){var n=N(e);return n>=0&&(E[n]=0,J[n].srcObject=null,console.log("reset_videorender "+n)),n}function I(e){var n=N(e);if(void 0!=n)return n;for(var o=0;o<E.length;o++)if(0==E[o])return E[o]=e,o}function N(e){for(var n=0;n<E.length;n++)if(E[n]==e)return n}function C(e,n){var o=e["plugindata"];if(null!=o){var r=o["data"];if(null==r)return;if(null!=r["joining"]){var t=r["joining"],s=t["id"],i=t["display"],c=t["terminal"],a=I(s);a>=0&&n("joining",s,i,a+1),console.log("new member:"+s+" "+i+" "+c)}else if(null!=r["publishers"]){var l=r["publishers"];M(l,n)}else{if(null!=r["leaving"]){var u=r["leaving"],d=B(u);return console.log("member:"+u+" is leaving "+d),void(d>=0&&n("leaving",u,null,d+1))}if(null!=r["unpublished"]){var f=r["unpublished"],m=r["mediatype"];console.log("member:"+f+" unpublish media type:"+m);var g=N(f);"screen"==m?J[3].srcObject=null:g>=0&&(J[g].srcObject=null),g>=0&&n("unpublish",m,null,g+1)}}}}b.init=function(e,n,o){console.log("ClassHandler init"),"WebSocket"in window&&(h=new WebSocket("wss://s6-meeting.unicloud.com/janus_wss","janus-protocol"),h.onopen=function(){console.log("连接 服务器成功");var e=r.createSession();h.send(e);for(var o=0;o<n.length;o++)console.log(n[o]),E[o]=0;J=n},h.onmessage=function(e){var s=e.data;console.log(s);var c=JSON.parse(s),u=c["janus"];if(null!=u){var d=c["transaction"],f=t[d];if(null!=f)if("success"==u){console.log("sync event");var g=0,v=f.success(s);if(void 0!=f.id&&(g=f.id()),console.log(v),v==t["syncSignal"]["createsession"]){console.log("createsession"),S=g;var p=i(S);h.send(p),setInterval((function(){h.send(r.createKeepAlive())}),5e3)}else if(v==t["syncSignal"]["createhandle"]){if(console.log("createhandle:"),0==j)j=g;else if(0==w)w=g;else if(0==O)O=g;else if(0==k){k=g;var b=a(_,S,j);return void h.send(b)}console.log("session id:"+S);var J=i(S);h.send(J)}else if(v==t["syncSignal"]["createroom"]){console.log("sync create room:");var B=l(_,S,j);h.send(B)}else if(v==t["syncSignal"]["subhandle"]){console.log("sync create subhandle:");var I=f.submedia();h.send(I)}}else if("event"==u){var P=f.event(s);if(P==t["eventSignal"]["joinroom"]){var R=f.publishers();x=f.id();var q=f.membserlists(),T=0;for(var D in q)E[T]=D,x==D&&(console.log("my index:"+T),y=T),T++;o("joined",x,q),M(R,null)}else if(P==t["eventSignal"]["createsuboffer"]){var A=f.getoffer(),H=f.getmedia();if("video"==H){var $=N(f.userid());$>=0&&(console.log("video index:"+$),m(A,_,S,f.id(),n[$],(function(e){h.send(e)})))}else"screen"==H&&(console.log("play screen"),m(A,_,S,f.id(),n[3],(function(e){h.send(e)})),E[E.length-1]=f.userid())}}else"ack"!=u&&f.error(s);else C(c,o)}},h.onerror=function(e){console.log(e)},h.onclose=function(){console.log("连接关闭")})},b.openvideo=function(e){var n=t["openvideo"];null==n||0==n?(console.log("打开视频:"+y),v(S,O,"video",J[y],(function(n){console.log("video local sdp:"+n),h.send(n),t["openvideo"]=!0;var o=I(x);console.log("打开 local index:"+o),e(o+1,!0)}))):(console.log("关闭视频"),p(S,O,(function(n){console.log("del video publisher:"+n),h.send(n),t["openvideo"]=!1;var o=N(x);o>=0&&(J[o].srcObject=null,e(o+1,!1)),console.log("关闭local index:"+o)})))},b.openaudio=function(e){var n=t["openaudio"];null==n||0==n?(console.log("打开音频"),v(S,w,"audio",null,(function(n){console.log("audio local sdp:"+n),h.send(n),t["openaudio"]=!0;var o=I(x);e(o+1,!0)}))):(console.log("关闭音频"),p(S,w,(function(n){console.log("del audio publisher:"+n),h.send(n),t["openaudio"]=!1;var o=N(x);e(o+1,!1)})))},b.openscreen=function(e){var n=t["openscreen"];null==n||0==n?(console.log("打开桌面"),v(S,k,"screen",null,(function(n){console.log("screen local sdp:"+n),h.send(n),t["openscreen"]=!0;var o=I(x);e(o+1,!0)}))):(console.log("关闭桌面"),p(S,k,(function(n){console.log("del screen publisher:"+n),h.send(n),t["openscreen"]=!1;var o=N(x);e(o+1,!1)})))},b.leavemeet=function(){console.log("离开房间");var e=u(_,S,j);h.send(e)},e.exports=b},ffb5:function(e,n,o){e.exports=o.p+"img/audio-off.7a997182.svg"}});
//# sourceMappingURL=app.7dc26ec6.js.map